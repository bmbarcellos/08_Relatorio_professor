<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relatório de Prova Digital</title>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: #f2f4f7;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #003366;
    color: white;
    padding: 16px;
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 1.5rem;
  }
  header h2 {
    margin: 4px 0 0 0;
    font-size: 1.1rem;
    font-weight: normal;
  }
  .container {
    max-width: 1200px;
    margin: 24px auto;
    padding: 0 16px;
  }
  .resumo {
    background-color: #ffffff;
    border-radius: 8px;
    padding: 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .resumo div {
    flex: 1 1 200px;
    background-color: #e6f0ff;
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }
  .resumo div span {
    display: block;
    font-weight: bold;
    font-size: 1.2rem;
    margin-top: 4px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 24px;
    background-color: #ffffff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }
  th {
    background-color: #003366;
    color: white;
  }
  td.violacoes {
    color: #b00020;
    font-weight: bold;
  }
  canvas {
    margin-top: 24px;
    background-color: #ffffff;
    border-radius: 8px;
    padding: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
</style>
</head>
<body>
<header>
  <h1>Universidade Federal Fluminense</h1>
  <h2>Sistema de Prova Digital - Relatório Gerencial</h2>
</header>
<div class="container">
  <div class="resumo" id="resumo-estatisticas">
    <!-- Estatísticas derivadas serão inseridas aqui -->
  </div>
  <canvas id="boxplotNotas" height="150"></canvas>
  <table id="tabela-alunos">
    <thead>
      <tr>
        <th>Aluno</th>
        <th>Matrícula</th>
        <th>Nota</th>
        <th>Duração da prova (min)</th>
        <th>Violações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const dados = JSON.parse(localStorage.getItem('relatorio_dados'));
if (!dados) {
  alert('Nenhum dado encontrado. Volte à página inicial.');
}

// ===== Estatísticas derivadas =====
const notas = dados.alunos.map(a => a.nota);
const totalQuestoes = dados.questoes.length;
const media = dados.media_turma;
const minNota = Math.min(...notas);
const maxNota = Math.max(...notas);
const somaTempo = dados.tempo_medio_min * dados.total_alunos;
const desvio = Math.sqrt(notas.reduce((acc,n) => acc + Math.pow(n - media,2),0)/notas.length);

const acimaMedia = dados.alunos.filter(a => a.nota > media).length;
const abaixoMedia = dados.alunos.filter(a => a.nota < media).length;

// Monta a seção de resumo
const resumoDiv = document.getElementById('resumo-estatisticas');
resumoDiv.innerHTML = `
  <div>Alunos <span>${dados.total_alunos}</span></div>
  <div>Questões <span>${totalQuestoes}</span></div>
  <div>Média da turma <span>${media.toFixed(2)}</span></div>
  <div>Desvio padrão <span>${desvio.toFixed(2)}</span></div>
  <div>Nota mínima <span>${minNota}</span></div>
  <div>Nota máxima <span>${maxNota}</span></div>
  <div>Acima da média <span>${acimaMedia}</span></div>
  <div>Abaixo da média <span>${abaixoMedia}</span></div>
  <div>Duração da prova (min) <span>${dados.tempo_medio_min}</span></div>
`;

// ===== Tabela de alunos =====
const tbody = document.querySelector('#tabela-alunos tbody');
dados.alunos.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(a => {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${a.nome}</td>
    <td>${a.matricula}</td>
    <td>${a.nota}</td>
    <td>${a.duracao_min}</td>
    <td class="violacoes">${JSON.stringify(a.violacoes)}</td>
  `;
  tbody.appendChild(tr);
});

// ===== Boxplot de notas =====
const ctx = document.getElementById('boxplotNotas').getContext('2d');
new Chart(ctx, {
  type: 'boxplot',
  data: {
    labels: ['Notas'],
    datasets: [{
      label: 'Distribuição de notas',
      data: [notas],
      borderColor: '#003366',
      backgroundColor: '#e6f0ff'
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>
</body>
</html>
